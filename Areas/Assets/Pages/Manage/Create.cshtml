@page
@model AssetManagement.Areas.Assets.Pages.Manage.CreateModel

<h1>Create Asset</h1>

<form method="post">
  <div asp-validation-summary="All" class="text-danger"></div>

  <div class="row">
    <div class="col-md-6">
      <!-- MASTER -->
      <div class="mb-3">
        <label asp-for="Vm.ZRef_AssetTypeId"></label>
        <select asp-for="Vm.ZRef_AssetTypeId" asp-items="Model.Vm.Types" class="form-control" id="assetType"></select>
        <span asp-validation-for="Vm.ZRef_AssetTypeId" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.ZRef_AssetClusterId"></label>
        <select asp-for="Vm.ZRef_AssetClusterId" asp-items="Model.Vm.Clusters" class="form-control"></select>
        <span asp-validation-for="Vm.ZRef_AssetClusterId" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.ZRef_AssetCategoryId"></label>
        <select asp-for="Vm.ZRef_AssetCategoryId" asp-items="Model.Vm.Categories" class="form-control"></select>
        <span asp-validation-for="Vm.ZRef_AssetCategoryId" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.Reg_VillageCode"></label>
        <select asp-for="Vm.Reg_VillageCode" asp-items="Model.Vm.Villages" class="form-control"></select>
        <span asp-validation-for="Vm.Reg_VillageCode" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.ZRef_OwnershipTypeId"></label>
        <select asp-for="Vm.ZRef_OwnershipTypeId" asp-items="Model.Vm.OwnershipTypes" class="form-control"></select>
        <span asp-validation-for="Vm.ZRef_OwnershipTypeId" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.ZRef_AssetAvailabilityId"></label>
        <select asp-for="Vm.ZRef_AssetAvailabilityId" asp-items="Model.Vm.Availabilities" class="form-control"></select>
        <span asp-validation-for="Vm.ZRef_AssetAvailabilityId" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.CostCenter"></label>
        <input asp-for="Vm.CostCenter" class="form-control" />
        <span asp-validation-for="Vm.CostCenter" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.SAP_Number"></label>
        <input asp-for="Vm.SAP_Number" class="form-control" />
        <span asp-validation-for="Vm.SAP_Number" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.Description"></label>
        <textarea asp-for="Vm.Description" class="form-control"></textarea>
        <span asp-validation-for="Vm.Description" class="text-danger"></span>
      </div>
    </div>
  </div>

  <!-- PARTIAL: TANAH -->
  <div id="landFields">
    @* Penting: HtmlFieldPrefix agar nama input = Vm.Land.* *@
    @{
      var vd = new ViewDataDictionary(ViewData);
      vd.TemplateInfo.HtmlFieldPrefix = "Vm.Land";
      vd["RightsTypes"] = Model.Vm.RightsTypes;
    }
    <partial name="../Partials/_LandFields" model="Model.Vm.Land" view-data="vd" />
  </div>

  <!-- PARTIAL: BANGUNAN (belum ada tabel, sembunyikan dulu) -->
  <div id="buildingFields" style="display:none">
    <div class="alert alert-info">Field Bangunan akan ditambahkan saat tabelnya siap.</div>
  </div>

  <button class="btn btn-primary" type="submit">Save</button>
  <a asp-area="Assets" asp-page="/Manage/Index" class="btn btn-secondary">Back</a>
</form>

@section Scripts{
  <partial name="_ValidationScriptsPartial" />
  <script src="https://cdn.jsdelivr.net/npm/autonumeric@4.10.5"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      AutoNumeric.multiple('.currency', {
        digitGroupSeparator: '.',
        decimalCharacter: ',',
        decimalCharacterAlternative: '.', 
        decimalPlaces: 0,
        formatOnPageLoad: true,           // format saat page load
        unformatOnSubmit: true,
        modifyValueOnWheel: false
      });

      // kirim angka polos ke server
      $('form').on('submit', function () {
        $('.currency').each(function () {
          const an = AutoNumeric.getAutoNumericElement(this);
          if (an) this.value = an.getNumber();
        });
      });
    });
  </script>
}


