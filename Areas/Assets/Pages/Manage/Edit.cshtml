@page "{id:int}"
@model AssetManagement.Areas.Assets.Pages.Manage.EditModel

<h3>Edit Asset</h3>

<form method="post">
  <div asp-validation-summary="All" class="text-danger"></div>

  <div class="row">
    <div class="col-md-6">
      <div class="mb-3">
        <label asp-for="Vm.ZRef_AssetTypeId"></label>
        <select asp-for="Vm.ZRef_AssetTypeId" asp-items="Model.Vm.Types" class="form-control" disabled></select>
        <input type="hidden" asp-for="Vm.ZRef_AssetTypeId" /> @* disabled tidak ter-post, jadi sembunyikan nilai *@
      </div>

      <div class="mb-3">
        <label asp-for="Vm.ZRef_AssetCategoryId"></label>
        <select asp-for="Vm.ZRef_AssetCategoryId" asp-items="Model.Vm.Categories" class="form-control"></select>
        <span asp-validation-for="Vm.ZRef_AssetCategoryId" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.ZRef_AssetClusterId"></label>
        <select asp-for="Vm.ZRef_AssetClusterId" asp-items="Model.Vm.Clusters" class="form-control"></select>
        <span asp-validation-for="Vm.ZRef_AssetClusterId" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.ZRef_OwnershipTypeId"></label>
        <select asp-for="Vm.ZRef_OwnershipTypeId" asp-items="Model.Vm.OwnershipTypes" class="form-control"></select>
        <span asp-validation-for="Vm.ZRef_OwnershipTypeId" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.ZRef_AssetAvailabilityId"></label>
        <select asp-for="Vm.ZRef_AssetAvailabilityId" asp-items="Model.Vm.Availabilities" class="form-control"></select>
        <span asp-validation-for="Vm.ZRef_AssetAvailabilityId" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.Reg_VillageCode"></label>
        <select asp-for="Vm.Reg_VillageCode" asp-items="Model.Vm.Villages" class="form-control"></select>
        <span asp-validation-for="Vm.Reg_VillageCode" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.CostCenter"></label>
        <input asp-for="Vm.CostCenter" class="form-control" />
        <span asp-validation-for="Vm.CostCenter" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.SAP_Number"></label>
        <input asp-for="Vm.SAP_Number" class="form-control" />
        <span asp-validation-for="Vm.SAP_Number" class="text-danger"></span>
      </div>

      <div class="mb-3">
        <label asp-for="Vm.Description"></label>
        <textarea asp-for="Vm.Description" class="form-control"></textarea>
        <span asp-validation-for="Vm.Description" class="text-danger"></span>
      </div>
    </div>
  </div>

  @if (Model.Vm.ZRef_AssetTypeId == 1)
  {
      var vd = new ViewDataDictionary(ViewData);
      vd["RightsTypes"] = Model.Vm.RightsTypes;
      <partial name="../Partials/_LandFields" for="Vm.Land" view-data="vd" />
  }

  <button type="submit" class="btn btn-primary">Simpan</button>
  <a asp-page="Index" class="btn btn-secondary">Back</a>
</form>

@section Scripts{
  <partial name="_ValidationScriptsPartial" />
  <script src="https://cdn.jsdelivr.net/npm/autonumeric@4.10.5"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // 0) Normalisasi value dari server: "2000000.0000" -> "2000000"
      document.querySelectorAll('.currency').forEach(el => {
        let v = (el.value || '').trim();
        if (!v) return;
        v = v.replace(/\s/g,'');
        if (/[.,]/.test(v)) {
          v = v.replace(/\./g,'').replace(',', '.'); // "1.234,56" / "1234.56" -> "1234.56"
        }
        const n = Number(v);
        if (!Number.isNaN(n)) el.value = String(Math.round(n)); // karena decimalPlaces:0
      });

      // 1) Inisialisasi AutoNumeric
      AutoNumeric.multiple('.currency', {
        digitGroupSeparator: '.',
        decimalCharacter: ',',
        decimalPlaces: 0,              // set ke 2 kalau mau ,00
        formatOnPageLoad: true,
        unformatOnSubmit: true,
        modifyValueOnWheel: false
      });

      // 2) Submit kirim angka polos
      document.querySelector('form')?.addEventListener('submit', function () {
        document.querySelectorAll('.currency').forEach(el => {
          const an = AutoNumeric.getAutoNumericElement(el);
          if (an) el.value = an.getNumber();
        });
      });
    });
  </script>
}



